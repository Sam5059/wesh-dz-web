Objectif
Corriger le syst√®me de s√©lection des wilayas et communes dans le formulaire de publication d'annonces. Actuellement, les wilayas s'affichent comme "undefined" et les communes ne se filtrent pas selon la wilaya s√©lectionn√©e.
üìã Contexte de l'application

App: Marketplace alg√©rienne (OuechDZ/BuyNgo)
Stack: React Native/Expo + Supabase
Donn√©es: 58 wilayas alg√©riennes + communes associ√©es

üî¥ Probl√®mes identifi√©s

Wilayas undefined dans les dropdowns de s√©lection
Communes non filtr√©es selon la wilaya choisie
Perte de synchronisation entre les deux champs

üìä Structure attendue des donn√©es
typescript// Table: wilayas
{
  id: number,
  code: string, // "01", "02", etc.
  name_fr: string,
  name_ar: string,
  name_en: string
}

// Table: communes
{
  id: number,
  wilaya_id: number, // FK vers wilayas
  name_fr: string,
  name_ar: string,
  name_en: string
}
üõ†Ô∏è Corrections √† apporter
1. V√©rifier la requ√™te Supabase
typescript// ‚ùå Probl√®me probable
const { data: wilayas } = await supabase.from('wilayas').select('*');

// ‚úÖ Solution
const { data: wilayas, error } = await supabase
  .from('wilayas')
  .select('id, code, name_fr, name_ar, name_en')
  .order('code', { ascending: true });

if (error) console.error('Erreur wilayas:', error);
2. Composant de s√©lection Wilaya
Cr√©er/corriger le composant avec :

Chargement des wilayas au montage
Gestion des √©tats (loading, error, data)
Affichage correct du label (name_fr ou name_ar selon la langue)
R√©initialisation de la commune quand la wilaya change

3. Composant de s√©lection Commune
Cr√©er/corriger avec :

Filtre dynamique bas√© sur wilaya_id
D√©sactivation si aucune wilaya s√©lectionn√©e
Rechargement automatique lors du changement de wilaya

üíª Code √† impl√©menter
Hook personnalis√© pour la gestion
typescriptconst useLocationData = () => {
  const [wilayas, setWilayas] = useState([]);
  const [communes, setCommunes] = useState([]);
  const [selectedWilaya, setSelectedWilaya] = useState(null);
  const [selectedCommune, setSelectedCommune] = useState(null);
  const [loading, setLoading] = useState(true);

  // Charger les wilayas
  useEffect(() => {
    loadWilayas();
  }, []);

  // Charger les communes quand la wilaya change
  useEffect(() => {
    if (selectedWilaya) {
      loadCommunesByWilaya(selectedWilaya);
      setSelectedCommune(null); // Reset commune
    }
  }, [selectedWilaya]);

  const loadWilayas = async () => {
    // Impl√©mentation
  };

  const loadCommunesByWilaya = async (wilayaId) => {
    // Impl√©mentation
  };

  return {
    wilayas,
    communes,
    selectedWilaya,
    selectedCommune,
    setSelectedWilaya,
    setSelectedCommune,
    loading
  };
};
Composant Dropdown
typescript<Dropdown
  data={wilayas}
  labelField="name_fr" // ou name_ar selon locale
  valueField="id"
  placeholder="Dans quelle wilaya ?"
  value={selectedWilaya}
  onChange={(item) => setSelectedWilaya(item.id)}
/>

<Dropdown
  data={communes}
  labelField="name_fr"
  valueField="id"
  placeholder="Dans quelle commune ?"
  value={selectedCommune}
  onChange={(item) => setSelectedCommune(item.id)}
  disable={!selectedWilaya}
/>
‚úÖ Points de validation

 Les wilayas s'affichent avec leur nom correct
 Les wilayas sont tri√©es par code (01 √† 58)
 La s√©lection d'une wilaya charge ses communes
 Le champ commune se r√©initialise au changement de wilaya
 Le champ commune est d√©sactiv√© si pas de wilaya
 Gestion des erreurs affich√©e √† l'utilisateur
 Support multilingue (FR/AR/EN)

üîç D√©bogage sugg√©r√©
Ajouter des logs √† ces points :

Apr√®s la requ√™te wilayas: console.log('Wilayas charg√©es:', wilayas?.length)
Apr√®s la requ√™te communes: console.log('Communes pour wilaya', wilayaId, ':', communes?.length)
Au changement de wilaya: console.log('Wilaya s√©lectionn√©e:', selectedWilaya)


Note: V√©rifie √©galement que les RLS (Row Level Security) policies dans Supabase autorisent la lecture publique des tables wilayas et communes.R√©essayerClaude peut faire des erreurs. Assurez-vous de v√©rifier ses r√©ponses. Sonnet 4.5